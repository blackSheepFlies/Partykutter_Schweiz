<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Swiss Boarding Pass – Abruf</title>
<style>
  :root{ --accent:#d40000; --label:#222; }
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin:0; background:#f6f6f6;}
  header{background:white; padding:14px 18px; border-bottom:1px solid #e5e5e5;}
  header h1{margin:0; font-size:18px}
  main{max-width:980px; margin:18px auto; padding:0 16px 28px; display:grid; gap:16px;}
  .card{background:#fff; border:1px solid #e7e7e7; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,.03);}
  .row{display:flex; gap:10px; align-items:center}
  .pad{padding:16px}
  label{font-size:14px; color:var(--label); white-space:nowrap}
  input[type="text"]{flex:1; padding:12px 14px; border:1px solid #ddd; border-radius:10px; font-size:16px}
  button{appearance:none; border:1px solid var(--accent); background:var(--accent); color:#fff; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer}
  .canvas-wrap{padding:16px; display:flex; justify-content:center; align-items:center}
  canvas{max-width:100%; height:auto; background:#fff; border-radius:10px; border:1px solid #eee}
  .hint{padding:0 16px 16px; color:#666; font-size:12px}
</style>
</head>
<body>
<header><h1>Swiss Boarding Pass – Name eintragen & herunterladen</h1></header>

<main>
  <section class="card pad">
    <div class="row">
      <label for="name">Passenger Name:</label>
      <input id="name" type="text" placeholder="z. B. Pilot Minion" />
      <button id="download">Get your Boarding Pass</button>
    </div>
  </section>

  <section class="card canvas-wrap">
    <canvas id="c" width="1536" height="1024" aria-label="Ticket Vorschau"></canvas>
  </section>
  <p class="hint">Falls das Ticket-Bild nicht erscheint: Lade <b>ticket_base.png</b> (dein Boardingpass ohne Namen) ins Repo.</p>
</main>

<script>
(() => {
  const BASE_IMAGE_URL = 'ticket_base.png';      // Ticket ohne Namen (PNG)
  const FONT_FAMILY = "'Helvetica Neue', Helvetica, Arial, system-ui, sans-serif";
  const FONT_WEIGHT = 700;
  const TEXT_COLOR = "#111";
  const STROKE = {show:true, width:4, color:"#ffffff"};     // dünne weiße Kontur hinter dem Namen
  const NAME_FONT_SIZE = 28;                                 // feste Schriftgröße für Name & Label

  const els = {
    name: document.getElementById('name'),
    download: document.getElementById('download'),
    canvas: document.getElementById('c')
  };
  const ctx = els.canvas.getContext('2d');

  const img = new Image();
  img.src = BASE_IMAGE_URL + '?v=' + Date.now();
  img.onload = draw;
  img.onerror = () => {
    ctx.fillStyle = "#fff"; ctx.fillRect(0,0,els.canvas.width,els.canvas.height);
    ctx.fillStyle = "#c00"; ctx.font = "20px " + FONT_FAMILY;
    ctx.fillText("ticket_base.png nicht gefunden – lade dein Ticketbild hoch.", 24, 40);
  };

  // Position der Beschriftung auf dem Ticket (bei Bedarf einmalig anpassen)
  const baseX = 160;   // x-Startpunkt der Label-Zeile
  const baseY = 140;   // y-Position der Label-Zeile
  const labelText = "Passenger Name:";
  const gap = 20;      // Abstand zwischen Label und Name

  function draw(){
    ctx.clearRect(0,0,els.canvas.width,els.canvas.height);
    ctx.drawImage(img, 0, 0, els.canvas.width, els.canvas.height);

    // Schrift setzen
    ctx.font = `${FONT_WEIGHT} ${NAME_FONT_SIZE}px ${FONT_FAMILY}`;
    ctx.textBaseline = "top";
    ctx.fillStyle = TEXT_COLOR;

    // Falls das Label NICHT Teil deines Basistickets ist, kannst du es hier mitzeichnen:
    // ctx.fillText(labelText, baseX, baseY);

    const name = (els.name.value || '').trim();
    if (!name) return;

    const labelWidth = ctx.measureText(labelText).width;
    const nameX = baseX + labelWidth + gap;
    const nameY = baseY;

    if (STROKE.show){
      ctx.lineWidth = STROKE.width;
      ctx.strokeStyle = STROKE.color;
      ctx.strokeText(name, nameX, nameY);
    }
    ctx.fillText(name, nameX, nameY);
  }

  els.name.addEventListener('input', draw);
  els.download.addEventListener('click', ()=>{
    draw();
    const a = document.createElement('a');
    const clean = (els.name.value || 'Passenger').replace(/[^\w\-äöüÄÖÜß ]+/g,'').trim().replace(/\s+/g,'_');
    a.download = `BoardingPass_${clean}.png`;
    a.href = els.canvas.toDataURL('image/png');
    a.click();
  });

  draw();
})();
</script>
</body>
</html>
